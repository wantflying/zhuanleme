<!--pages/index/index.wxml-->
<view class="container {{themeClass}}">
  <!-- 顶部状态栏 -->
  <view class="status-bar">
    <view class="app-title" bindtap="refreshMotto"><text class="bold">{{mottoSymbols[0]}}{{mottoText}}{{mottoSymbols[1]}}</text></view>
    <view class="settings-btn" bindtap="showSettingsPanel">⚙️</view>
  </view>

  <!-- 今日收益卡片 -->
  <view class="card income-card" bindtap="navigateToIncome">
    <view class="card-header">
      <view class="card-title">今日收益</view>
      <view class="card-subtitle">{{todayIncome.isTodayWorkday ? '工作日' : '休息日'}}</view>
    </view>
    
    <view class="income-content">
      <view class="income-time">{{currentTime}}</view>
      <view class="income-amount" animation="{{incomeAnimation}}">
        <text class="currency">¥</text>
        <text class="amount">{{todayIncome.todayEarned}}</text>
      </view>
    </view>
  </view>

  <!-- 快捷导航 -->
  <view class="nav-grid">
    <view class="nav-item" bindtap="navigateToDepreciation">
      <view class="nav-icon">📱</view>
      <view class="nav-title">物品成本</view>
      <view class="nav-desc">{{itemStats.totalItems}}件物品</view>
    </view>
    
    <view class="nav-item" bindtap="navigateToRetirement">
      <view class="nav-icon">⏰</view>
      <view class="nav-title">退休倒计时</view>
      <view class="nav-desc">{{retirement.daysToRetirement}}天</view>
    </view>
  </view>

  <!-- 统计概览 -->
  <view class="stats-section">
    <view class="section-title">数据概览</view>
    
    <view class="stats-grid">
      <view class="stat-item">
        <view class="stat-value">¥{{itemStats.totalCost}}</view>
        <view class="stat-label">总购买成本</view>
      </view>
      
      <view class="stat-item">
        <view class="stat-value">¥{{itemStats.totalUsedCost}}</view>
        <view class="stat-label">已用成本</view>
      </view>
      
      <view class="stat-item">
        <view class="stat-value">{{retirement.workdaysToRetirement}}</view>
        <view class="stat-label">剩余工作日</view>
      </view>
      
      <view class="stat-item">
        <view class="stat-value">{{retirement.workhourToRetirement}}</view>
        <view class="stat-label">剩余工作时</view>
      </view>
    </view>
  </view>

  <!-- 设置面板 -->
  <view class="settings-panel {{showSettings ? 'show' : ''}}" bindtap="hideSettingsPanel">
    <view class="settings-content" catchtap="stopPropagation">
      <view class="settings-header">
        <view class="settings-title">偏好设置</view>
        <view class="close-btn" bindtap="hideSettingsPanel">×</view>
      </view>
      
      <scroll-view scroll-y class="settings-body">
        <view class="setting-section">
          <view class="section-title">主题设置</view>
          
          <view class="setting-item">
            <text class="setting-label">主题风格</text>
            <picker range="{{['默认主题', '像素风']}}" value="{{prefs.theme === 'pixel' ? 1 : 0}}" bindchange="onThemeChange">
              <view class="picker-display">{{prefs.theme === 'pixel' ? '像素风' : '默认主题'}}</view>
            </picker>
          </view>
          
          <view class="setting-item" wx:if="{{prefs.theme === 'pixel'}}">
            <text class="setting-label">像素风配色</text>
            <picker range="{{pixelColorRangeLabels}}" value="{{pixelColorIndex}}" bindchange="onPixelColorChange">
              <view class="picker-display">{{pixelColorLabel}}</view>
            </picker>
          </view>
        </view>
        
        <view class="setting-section">
          <view class="section-title">动效设置</view>
          
          <view class="setting-item">
            <view class="setting-label">开启收益动效</view>
            <switch checked="{{prefs.enableIncomeAnimation}}" bindchange="onAnimationToggle" />
          </view>
        </view>

        <view class="setting-section">
          <view class="section-title">震动反馈</view>
          <view class="setting-item">
            <view class="setting-label">开启震动</view>
            <switch checked="{{prefs.hapticsEnabled}}" bindchange="onHapticsToggle" />
          </view>
          <view class="setting-item">
            <text class="setting-label">震动等级</text>
            <picker range="{{['轻','中','重']}}" value="{{prefs.hapticsLevel === 'heavy' ? 2 : (prefs.hapticsLevel === 'medium' ? 1 : 0)}}" bindchange="onHapticsLevelChange">
              <view class="picker-display">{{prefs.hapticsLevel === 'heavy' ? '重' : (prefs.hapticsLevel === 'medium' ? '中' : '轻')}}</view>
            </picker>
          </view>
        </view>

        <view class="setting-section">
          <view class="section-title">数据管理</view>
          <view class="setting-item">
            <view class="setting-label">导出数据</view>
            <view class="picker-display" bindtap="exportData">点击导出（复制到剪贴板）</view>
          </view>
          <view class="setting-item">
            <view class="setting-label">导入数据（粘贴JSON）</view>
            <textarea class="import-textarea" placeholder="在此粘贴导出的JSON文本" value="{{importText}}" bindinput="onImportTextChange" />
            <view class="settings-footer-inline">
              <view class="setting-btn secondary" bindtap="clearImportText">清空</view>
              <view class="setting-btn primary" bindtap="importData">导入</view>
            </view>
          </view>
          <view class="setting-item">
            <view class="setting-label">重置程序</view>
            <view class="picker-display danger" bindtap="resetProgram">重置程序（恢复初始设置并重启）</view>
          </view>
        </view>

        <view class="setting-help">
          <text>• 首页：点击左上角名言可切换；右上角齿轮进入设置</text>
          <text>• 主题：默认/像素风，可选多种配色</text>
          <text>• 动效：可开关；震动：可开关并选择等级</text>
          <text>• 数据：支持导入/导出JSON；重置可恢复初始状态</text>
          <text>• 收益/退休：更多设置请到对应页面调整</text>
        </view>
      </scroll-view>
      
      <view class="settings-footer">
        <view class="setting-btn primary" bindtap="hideSettingsPanel">完成</view>
      </view>
    </view>
  </view>
</view>


