<!--pages/index/index.wxml-->
<view class="container {{themeClass}}">
  <!-- 顶部状态栏 -->
  <view class="status-bar">
    <view class="status-left" bindtap="refreshDailyQuote">
      <view class="daily-quote">「{{dailyQuote}}」</view>
    </view>
    <view class="status-right">
      <view class="settings-btn plain" bindtap="showSettingsPanel">⚙️</view>
    </view>
  </view>

  <!-- 今日收益卡片 -->
  <view class="card income-card" bindtap="navigateToIncome">
    <view class="card-header">
      <view class="card-title-row">
        <view class="card-title">今日收益</view>
        <view class="card-time">{{currentTime}}</view>
      </view>
      <view class="card-subtitle">{{todayIncome.isTodayWorkday ? '工作日' : '休息日'}}</view>
    </view>
    
    <view class="income-content">
      <view class="income-amount" animation="{{incomeAnimation}}">
        <text class="currency">¥</text>
        <text class="amount">{{todayIncome.todayEarned}}</text>
      </view>
      <view class="income-simple-info">
        <text class="simple-label">点击查看详情</text>
      </view>
    </view>
  </view>

  <!-- 快捷导航 -->
  <view class="nav-grid">
    <view class="nav-item" bindtap="navigateToDepreciation">
      <view class="nav-icon">📱</view>
      <view class="nav-title">物品成本</view>
      <view class="nav-desc">{{itemStats.totalItems}}件物品</view>
    </view>
    
    <view class="nav-item" bindtap="navigateToRetirement">
      <view class="nav-icon">⏰</view>
      <view class="nav-title">退休倒计时</view>
      <view class="nav-desc">{{retirement.daysToRetirement}}天</view>
    </view>
  </view>

  <!-- 统计概览 -->
  <view class="stats-section">
    <view class="section-title">数据概览</view>
    
    <view class="stats-grid">
      <view class="stat-item">
        <view class="stat-value">¥{{itemStats.totalCost}}</view>
        <view class="stat-label">总购买成本</view>
      </view>
      
      <view class="stat-item">
        <view class="stat-value">¥{{itemStats.totalUsedCost}}</view>
        <view class="stat-label">已用成本</view>
      </view>
      
      <view class="stat-item">
        <view class="stat-value">{{retirement.workdaysToRetirement}}</view>
        <view class="stat-label">剩余工作日</view>
      </view>
      
      <view class="stat-item">
        <view class="stat-value">{{retirement.workhourToRetirement}}</view>
        <view class="stat-label">剩余工作时</view>
      </view>
    </view>
  </view>

  <!-- 设置面板 -->
  <view class="settings-panel {{showSettings ? 'show' : ''}}" bindtap="hideSettingsPanel">
    <view class="settings-content" catchtap="stopPropagation">
      <view class="settings-header">
        <view class="settings-title">偏好设置</view>
        <view class="close-btn" bindtap="hideSettingsPanel">×</view>
      </view>
      
      <scroll-view scroll-y class="settings-body">
        <view class="setting-section">
          <view class="section-title">主题设置</view>
          
          <view class="setting-item">
            <text class="setting-label">主题风格</text>
            <picker range="{{['默认主题', '像素风']}}" value="{{prefs.theme === 'pixel' ? 1 : 0}}" bindchange="onThemeChange">
              <view class="picker-display">{{prefs.theme === 'pixel' ? '像素风' : '默认主题'}}</view>
            </picker>
          </view>
          
          <view class="setting-item" wx:if="{{prefs.theme === 'pixel'}}">
            <text class="setting-label">像素风配色</text>
            <picker range="{{['薄荷色', '日落橙', '葡萄紫', '海洋蓝', '森林绿', '玫瑰金']}}" value="{{getPixelColorIndex(prefs.pixelColor)}}" bindchange="onPixelColorChange">
              <view class="picker-display">{{getPixelColorLabel(prefs.pixelColor)}}</view>
            </picker>
          </view>
        </view>
        
        <view class="setting-section">
          <view class="section-title">动效设置</view>
          
          <view class="setting-item">
            <view class="setting-label">开启收益动效</view>
            <switch checked="{{prefs.enableIncomeAnimation}}" bindchange="onAnimationToggle" />
          </view>
        </view>

        <view class="setting-section">
          <view class="section-title">数据管理</view>
          <view class="setting-item">
            <view class="setting-label">导出数据</view>
            <view class="picker-display" bindtap="exportData">点击导出（复制到剪贴板）</view>
          </view>
          <view class="setting-item">
            <view class="setting-label">导入数据（粘贴JSON）</view>
            <textarea class="import-textarea" placeholder="在此粘贴导出的JSON文本" value="{{importText}}" bindinput="onImportTextChange" />
            <view class="settings-footer-inline">
              <view class="setting-btn secondary" bindtap="clearImportText">清空</view>
              <view class="setting-btn primary" bindtap="importData">导入</view>
            </view>
          </view>
          <view class="setting-item">
            <view class="setting-label">重置程序</view>
            <view class="picker-display danger" bindtap="resetProgram">重置程序（恢复初始设置并重启）</view>
          </view>
        </view>
        <view class="setting-section">
          <view class="section-title">帮助</view>
          <view class="setting-item">
            <view class="setting-label">操作说明</view>
            <view class="picker-display" bindtap="showHelpPanel">查看简要说明</view>
          </view>
        </view>
        
        <view class="setting-help">
          <text>• 更多详细设置请到对应功能页面进行配置</text>
          <text>• 设置会自动保存到本地</text>
        </view>
      </scroll-view>
      
      <view class="settings-footer">
        <view class="setting-btn primary" bindtap="hideSettingsPanel">完成</view>
      </view>
    </view>
  </view>

  <!-- 操作说明弹层 -->
  <view class="help-panel {{showHelp ? 'show' : ''}}" bindtap="hideHelpPanel">
    <view class="help-content" catchtap="stopPropagation">
      <view class="help-header">
        <view class="help-title">操作说明</view>
        <view class="close-btn" bindtap="hideHelpPanel">×</view>
      </view>
      <scroll-view scroll-y class="help-body">
        <view class="help-section">
          <view class="help-subtitle">首页</view>
          <view class="help-list">
            <text>• 点击「今日收益」进入收益详情</text>
            <text>• 下方两个卡片可进入「物品成本」「退休倒计时」</text>
            <text>• 右上角齿轮进入偏好设置，❓查看本说明</text>
          </view>
        </view>
        <view class="help-section">
          <view class="help-subtitle">物品成本</view>
          <view class="help-list">
            <text>• 右下角 + 添加物品，支持价格/日期/折旧率</text>
            <text>• 左右滑动条目：编辑/删除</text>
            <text>• 顶部可筛选分类、按价格/日期排序</text>
          </view>
        </view>
        <view class="help-section">
          <view class="help-subtitle">收益与退休</view>
          <view class="help-list">
            <text>• 收益页面可切换「平均/精确」模式</text>
            <text>• 退休页面可设置年龄/生日并切换模式</text>
            <text>• 节假日页可一键应用法定节假日/调休</text>
          </view>
        </view>
        <view class="help-section">
          <view class="help-subtitle">数据</view>
          <view class="help-list">
            <text>• 设置里可导出/导入JSON进行备份恢复</text>
            <text>• 如需重置，使用「重置程序」将恢复初始状态</text>
          </view>
        </view>
      </scroll-view>
      <view class="help-footer">
        <view class="setting-btn primary" bindtap="hideHelpPanel">知道了</view>
      </view>
    </view>
  </view>
</view>


