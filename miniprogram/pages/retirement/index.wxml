<!--pages/retirement/index.wxml-->
<view class="container {{themeClass}}">
  <!-- å¤´éƒ¨ä¿¡æ¯ -->
  <view class="header-card card">
    <view class="header-info">
      <view class="age-display">
        <text class="current-age">{{ageInfo.currentAge}}</text>
        <text class="age-label">å²</text>
      </view>
      <view class="retirement-info">
        <view class="retirement-age">ç›®æ ‡é€€ä¼‘å¹´é¾„: {{ageInfo.retirementAge}}å²</view>
        <view class="mode-switch" bindtap="toggleRetirementMode">
          {{prefs.retirementMode === 'approximate' ? 'è¿‘ä¼¼æ¨¡å¼' : 'ç²¾ç¡®æ¨¡å¼'}}
        </view>
      </view>
    </view>
    
    <!-- è¿›åº¦æ¡ -->
    <view class="life-progress">
      <view class="progress-info">
        <text>äººç”Ÿè¿›åº¦</text>
        <text>{{chartData.progressPercent}}%</text>
      </view>
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{chartData.progressPercent}}%"></view>
      </view>
      <view class="progress-labels">
        <text>18å²å·¥ä½œ</text>
        <text>{{ageInfo.retirementAge}}å²é€€ä¼‘</text>
      </view>
    </view>
  </view>

  <!-- å€’è®¡æ—¶å±•ç¤º -->
  <view class="countdown-display card">
    <view class="countdown-main">
      <view class="countdown-item">
        <view class="countdown-number">{{retirement.daysToRetirement}}</view>
        <view class="countdown-label">å¤©</view>
      </view>
      
      <view class="countdown-item">
        <view class="countdown-number">{{ageInfo.yearsToRetirement}}</view>
        <view class="countdown-label">å¹´</view>
      </view>
      
      <view class="countdown-item">
        <view class="countdown-number">{{ageInfo.monthsToRetirement}}</view>
        <view class="countdown-label">æœˆ</view>
      </view>
    </view>
    
    <view class="countdown-detail">
      <view class="detail-text">è·ç¦»é€€ä¼‘è¿˜æœ‰</view>
      <view class="retirement-date">é¢„è®¡é€€ä¼‘æ—¥æœŸ: {{retirement.retirementDate}}</view>
    </view>
  </view>

  <!-- å·¥ä½œç»Ÿè®¡ -->
  <view class="work-stats card">
    <view class="card-title">å·¥ä½œç»Ÿè®¡</view>
    
    <view class="stats-grid">
      <view class="stat-box">
        <view class="stat-icon">ğŸ“…</view>
        <view class="stat-number">{{retirement.workdaysToRetirement}}</view>
        <view class="stat-label">å‰©ä½™å·¥ä½œæ—¥</view>
      </view>
      
      <view class="stat-box">
        <view class="stat-icon">â°</view>
        <view class="stat-number">{{retirement.workhourToRetirement}}</view>
        <view class="stat-label">å‰©ä½™å·¥ä½œæ—¶</view>
      </view>
      
      <view class="stat-box">
        <view class="stat-icon">ğŸ¯</view>
        <view class="stat-number">{{calcData.workdaysFromHours}}</view>
        <view class="stat-label">å·¥ä½œæ—¥è½¬æ¢</view>
      </view>
      
      <view class="stat-box">
        <view class="stat-icon">ğŸ“ˆ</view>
        <view class="stat-number">{{calcData.remainingWorkYears}}</view>
        <view class="stat-label">å‰©ä½™å·¥ä½œå¹´</view>
      </view>
    </view>
  </view>

  <!-- é‡Œç¨‹ç¢‘ -->
  <view class="milestones card">
    <view class="card-title">é‡è¦é‡Œç¨‹ç¢‘</view>
    
    <view class="milestone-list">
      <view class="milestone-item {{ageInfo.currentAge >= 30 ? 'completed' : ''}}">
        <view class="milestone-age">30å²</view>
        <view class="milestone-desc">èŒä¸šå‘å±•æœŸ</view>
        <view class="milestone-status">{{ageInfo.currentAge >= 30 ? 'âœ…' : 'â³'}}</view>
      </view>
      
      <view class="milestone-item {{ageInfo.currentAge >= 40 ? 'completed' : ''}}">
        <view class="milestone-age">40å²</view>
        <view class="milestone-desc">äº‹ä¸šå·…å³°æœŸ</view>
        <view class="milestone-status">{{ageInfo.currentAge >= 40 ? 'âœ…' : 'â³'}}</view>
      </view>
      
      <view class="milestone-item {{ageInfo.currentAge >= 50 ? 'completed' : ''}}">
        <view class="milestone-age">50å²</view>
        <view class="milestone-desc">è´¢å¯Œç§¯ç´¯æœŸ</view>
        <view class="milestone-status">{{ageInfo.currentAge >= 50 ? 'âœ…' : 'â³'}}</view>
      </view>
      
      <view class="milestone-item {{ageInfo.currentAge >= ageInfo.retirementAge ? 'completed' : ''}}">
        <view class="milestone-age">{{ageInfo.retirementAge}}å²</view>
        <view class="milestone-desc">äº«å—é€€ä¼‘ç”Ÿæ´»</view>
        <view class="milestone-status">{{ageInfo.currentAge >= ageInfo.retirementAge ? 'ğŸ‰' : 'ğŸ¯'}}</view>
      </view>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons">
    <view class="action-btn secondary" bindtap="refreshData">
      <text class="btn-icon">ğŸ”„</text>
      <text class="btn-text">åˆ·æ–°</text>
    </view>
    
    <view class="action-btn primary" bindtap="showSettingsPanel">
      <text class="btn-icon">âš™ï¸</text>
      <text class="btn-text">è®¾ç½®</text>
    </view>
    
    <view class="action-btn success" bindtap="shareRetirement">
      <text class="btn-icon">ğŸ“‹</text>
      <text class="btn-text">åˆ†äº«</text>
    </view>
    
    <view class="action-btn info" bindtap="viewRetirementPlan">
      <text class="btn-icon">ğŸ’¡</text>
      <text class="btn-text">å»ºè®®</text>
    </view>
  </view>

  <!-- è®¾ç½®é¢æ¿ -->
  <view class="settings-panel {{showSettings ? 'show' : ''}}" bindtap="hideSettingsPanel">
    <view class="settings-content" catchtap="stopPropagation">
      <view class="settings-header">
        <view class="settings-title">é€€ä¼‘è®¾ç½®</view>
        <view class="close-btn" bindtap="hideSettingsPanel">Ã—</view>
      </view>
      
      <scroll-view scroll-y class="settings-body">
        <view class="setting-section">
          <view class="section-title">åŸºæœ¬ä¿¡æ¯</view>
          
          <view class="setting-item">
            <text class="setting-label">å½“å‰å¹´é¾„</text>
            <input class="setting-input" 
                   type="number"
                   placeholder="è¯·è¾“å…¥å½“å‰å¹´é¾„"
                   value="{{tempPrefs.currentAge}}"
                   data-field="currentAge"
                   bindinput="onTempPrefChange"
                   confirm-type="done" />
          </view>
          
          <view class="setting-item">
            <text class="setting-label">é€€ä¼‘å¹´é¾„</text>
            <input class="setting-input" 
                   type="number"
                   placeholder="è¯·è¾“å…¥é€€ä¼‘å¹´é¾„"
                   value="{{tempPrefs.retirementAge}}"
                   data-field="retirementAge"
                   bindinput="onTempPrefChange"
                   confirm-type="done" />
          </view>
          
          <view class="setting-item">
            <text class="setting-label">ç”Ÿæ—¥æ—¥æœŸ (å¯é€‰)</text>
            <picker mode="date" 
                    value="{{tempPrefs.birthday}}"
                    data-field="birthday"
                    bindchange="onDateChange">
              <view class="picker-display">{{tempPrefs.birthday || 'é€‰æ‹©ç”Ÿæ—¥(æ›´ç²¾ç¡®)'}}</view>
            </picker>
          </view>
        </view>
        
        <view class="setting-section">
          <view class="section-title">è®¡ç®—è®¾ç½®</view>
          
          <view class="setting-item">
            <text class="setting-label">è®¡ç®—æ¨¡å¼</text>
            <picker range="{{retirementModeRange}}"
                    value="{{tempPrefs.retirementMode === 'approximate' ? 0 : 1}}"
                    data-field="retirementMode"
                    data-options="{{retirementModeOptions}}"
                    bindchange="onPickerChange">
              <view class="picker-display">{{retirementModeRange[tempPrefs.retirementMode === 'approximate' ? 0 : 1]}}</view>
            </picker>
          </view>
          
          <view class="setting-help">
            <text>â€¢ è¿‘ä¼¼æ¨¡å¼ï¼šæŒ‰å·¥ä½œæ—¥æ¯”ä¾‹ä¼°ç®—</text>
            <text>â€¢ ç²¾ç¡®æ¨¡å¼ï¼šè€ƒè™‘èŠ‚å‡æ—¥å’Œè°ƒä¼‘</text>
          </view>
        </view>
      </scroll-view>
      
      <view class="settings-footer">
        <view class="setting-btn secondary" bindtap="hideSettingsPanel">å–æ¶ˆ</view>
        <view class="setting-btn primary" bindtap="saveSettings">ä¿å­˜</view>
      </view>
    </view>
  </view>
</view>
