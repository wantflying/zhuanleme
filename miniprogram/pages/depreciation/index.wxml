<!--pages/depreciation/index.wxml-->
<view class="container {{themeClass}}">
  <!-- å¤´éƒ¨ç»Ÿè®¡ -->
  <view class="stats-header card">
    <view class="stats-grid">
      <view class="stat-item">
        <view class="stat-value">{{stats.totalItems}}</view>
        <view class="stat-label">ç‰©å“æ€»æ•°</view>
      </view>
      <view class="stat-item">
        <view class="stat-value">Â¥{{stats.totalCost}}</view>
        <view class="stat-label">æ€»æˆæœ¬</view>
      </view>
      <view class="stat-item">
        <view class="stat-value">Â¥{{stats.totalUsedCost}}</view>
        <view class="stat-label">å·²ç”¨æˆæœ¬</view>
      </view>
      <view class="stat-item">
        <view class="stat-value">Â¥{{stats.avgDailyUsageCost}}</view>
        <view class="stat-label">æ—¥å‡æˆæœ¬</view>
      </view>
    </view>
  </view>

  <!-- ç­›é€‰å’Œæ’åº -->
  <view class="filter-bar card">
    <view class="filter-section">
      <text class="section-title">ç­›é€‰:</text>
      <view class="filter-tags">
        <!-- ç³»ç»Ÿé»˜è®¤ç­›é€‰ -->
        <view class="filter-tag {{filterType === 'all' ? 'active' : ''}}" 
              data-type="all" bindtap="changeFilter">å…¨éƒ¨</view>
        <view class="filter-tag {{filterType === 'uncategorized' ? 'active' : ''}}" 
              data-type="uncategorized" bindtap="changeFilter">æœªåˆ†ç±»</view>
        
        <!-- ç”¨æˆ·è‡ªå®šä¹‰åˆ†ç±»ç­›é€‰ -->
        <view wx:for="{{availableCategories}}" wx:key="*this"
              class="filter-tag {{filterType === 'category:' + item ? 'active' : ''}}" 
              data-type="category:{{item}}" bindtap="changeFilter">{{item}}</view>
      </view>
    </view>
    
    <view class="sort-section">
      <text class="section-title">æ’åº:</text>
      <view class="sort-buttons">
        <view class="sort-btn {{sortBy === 'purchaseDate' ? 'active' : ''}}" 
              data-sort="purchaseDate" bindtap="changeSort">
          æ—¥æœŸ {{sortBy === 'purchaseDate' ? (sortOrder === 'desc' ? 'â†“' : 'â†‘') : ''}}
        </view>
        <view class="sort-btn {{sortBy === 'price' ? 'active' : ''}}" 
              data-sort="price" bindtap="changeSort">
          ä»·æ ¼ {{sortBy === 'price' ? (sortOrder === 'desc' ? 'â†“' : 'â†‘') : ''}}
        </view>
        <view class="sort-btn {{sortBy === 'usedCost' ? 'active' : ''}}" 
              data-sort="usedCost" bindtap="changeSort">
          å·²ç”¨æˆæœ¬ {{sortBy === 'usedCost' ? (sortOrder === 'desc' ? 'â†“' : 'â†‘') : ''}}
        </view>
      </view>
    </view>
    
    <view class="action-section">
      <view class="action-buttons-inline">
        <view class="action-btn-small danger" bindtap="clearAllData">
          ğŸ—‘ï¸ æ¸…é™¤æ•°æ®
        </view>
      </view>
    </view>
  </view>

  <!-- ç‰©å“åˆ—è¡¨ -->
  <view class="items-list">
    <view wx:for="{{items}}" wx:key="id" class="item-wrapper">
      <view class="item-slide-container">        
        <!-- æ»‘åŠ¨æ“ä½œæŒ‰é’® - å³ä¾§ -->
        <view class="slide-actions" wx:if="{{item.id === activeSlideId && slideX < -40}}">
          <view class="action-btn edit-btn" catchtap="editItem" data-id="{{item.id}}">
            <text class="action-icon">âœï¸</text>
            <text class="action-text">ç¼–è¾‘</text>
          </view>
          <view class="action-btn delete-btn" catchtap="deleteItem" data-id="{{item.id}}">
            <text class="action-icon">ğŸ—‘ï¸</text>
            <text class="action-text">åˆ é™¤</text>
          </view>
        </view>
        
        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <view class="item-card card fade-in {{item.id === activeSlideId ? 'sliding' : ''}}"
              bindtouchstart="onTouchStart"
              bindtouchmove="onTouchMove"
              bindtouchend="onTouchEnd"
              data-id="{{item.id}}"
              style="transform: translateX({{item.id === activeSlideId ? slideX : 0}}rpx)">
          
          <view class="item-header" bindtap="viewItemDetail" data-id="{{item.id}}">
            <view class="item-name">{{item.name}}</view>
            <view class="item-category">{{item.category || 'æœªåˆ†ç±»'}}</view>
          </view>
          
          <view class="item-info">
            <view class="info-row">
              <view class="info-item">
                <text class="label">è´­ä¹°ä»·æ ¼</text>
                <text class="value primary">Â¥{{item.price}}</text>
              </view>
              <view class="info-item">
                <text class="label">ä½¿ç”¨{{item.usedDays}}å¤©</text>
                <text class="value">{{item.purchaseDate}}</text>
              </view>
            </view>
            
            <view class="info-row">
              <view class="info-item">
                <text class="label">å½“å‰ä¼°å€¼</text>
                <text class="value success">Â¥{{item.currentValue}}</text>
              </view>
              <view class="info-item">
                <text class="label">å·²ç”¨æˆæœ¬</text>
                <text class="value warning">Â¥{{item.usedCost}}</text>
              </view>
            </view>
            
            <view class="info-row">
              <view class="info-item">
                <text class="label">æ—¥ç”¨æˆæœ¬</text>
                <text class="value danger">Â¥{{item.dailyUsageCost}}</text>
              </view>
              <view class="info-item">
                <text class="label">æŠ˜æ—§ç‡</text>
                <text class="value">{{item.depreciationRateDisplay}}%/å¹´</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{items.length === 0}}" class="empty-state">
      <view class="empty-icon">ğŸ“¦</view>
      <view class="empty-text">è¿˜æ²¡æœ‰æ·»åŠ ä»»ä½•ç‰©å“</view>
      <view class="empty-desc">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹è®°å½•ä½ çš„ç¬¬ä¸€ä»¶ç‰©å“å§</view>
    </view>
  </view>

  <!-- æ·»åŠ æŒ‰é’® -->
  <view class="add-button" bindtap="showAddItemForm">
    <text class="add-icon">+</text>
  </view>

  <!-- æ·»åŠ /ç¼–è¾‘è¡¨å• -->
  <view class="form-modal {{showAddForm ? 'show' : ''}}" catchtap="hideAddForm">
    <view class="form-content" catchtap="stopPropagation">
      <view class="form-header">
        <view class="form-title">{{editingId ? 'ç¼–è¾‘ç‰©å“' : 'æ·»åŠ ç‰©å“'}}</view>
        <view class="close-btn" bindtap="hideAddForm">Ã—</view>
      </view>
      
      <scroll-view scroll-y class="form-body">
        <view class="form-group">
          <text class="form-label">ç‰©å“åç§° *</text>
          <input class="form-input" 
                 placeholder="è¯·è¾“å…¥ç‰©å“åç§°" 
                 value="{{addForm.name}}"
                 data-field="name"
                 bindinput="onFormInput" />
        </view>
        
        <view class="form-group">
          <text class="form-label">è´­ä¹°ä»·æ ¼ *</text>
          <input class="form-input" 
                 type="digit"
                 placeholder="è¯·è¾“å…¥è´­ä¹°ä»·æ ¼" 
                 value="{{addForm.price}}"
                 data-field="price"
                 bindinput="onFormInput" />
        </view>
        
        <view class="form-group">
          <text class="form-label">è´­ä¹°æ—¥æœŸ *</text>
          <picker mode="date" 
                  value="{{addForm.purchaseDate}}"
                  bindchange="onDateChange">
            <view class="picker-display">{{addForm.purchaseDate || 'é€‰æ‹©æ—¥æœŸ'}}</view>
          </picker>
        </view>
        
        <view class="form-group">
          <text class="form-label">å½“å‰ä»·æ ¼ (å¯é€‰)</text>
          <input class="form-input" 
                 type="digit"
                 placeholder="æ‰‹åŠ¨è®¾ç½®å½“å‰ä»·æ ¼" 
                 value="{{addForm.currentPrice}}"
                 data-field="currentPrice"
                 bindinput="onFormInput" />
          <text class="form-help">ä¸å¡«å†™å°†æŒ‰æŠ˜æ—§ç‡è‡ªåŠ¨è®¡ç®—</text>
        </view>
        
        <view class="form-group">
          <text class="form-label">å¹´æŠ˜æ—§ç‡</text>
          <slider class="form-slider"
                  min="0"
                  max="1"
                  step="0.01"
                  value="{{addForm.depreciationRate}}"
                  data-field="depreciationRate"
                  bindchange="onSliderChange"
                  show-value />
          <text class="form-help">å½“å‰: {{formDisplay.depreciationRatePercent}}%</text>
        </view>
        
        <view class="form-group">
          <text class="form-label">åˆ†ç±» (å¯é€‰)</text>
          <input class="form-input" 
                 placeholder="å¦‚ï¼šç”µå­äº§å“ã€æœè£…ç­‰" 
                 value="{{addForm.category}}"
                 data-field="category"
                 bindinput="onFormInput" />
        </view>
        
        <view class="form-group">
          <text class="form-label">å¤‡æ³¨ (å¯é€‰)</text>
          <textarea class="form-textarea" 
                    placeholder="æ·»åŠ å¤‡æ³¨ä¿¡æ¯" 
                    value="{{addForm.description}}"
                    data-field="description"
                    bindinput="onFormInput" />
        </view>
      </scroll-view>
      
      <view class="form-footer">
        <view class="form-btn secondary" bindtap="hideAddForm">å–æ¶ˆ</view>
        <view class="form-btn primary" bindtap="saveItem">{{editingId ? 'ä¿å­˜' : 'æ·»åŠ '}}</view>
      </view>
    </view>
  </view>
</view>
